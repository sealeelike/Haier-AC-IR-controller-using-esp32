# Haier-AC-IR-controller-using-esp32/海尔空调红外物联网控制器

## Adding an extra infrared module to old air conditioners to realize IoT/旧空调加装红外模块实现物联网


## 背景
我的老式空调只有红外遥控功能，无物联网功能。
通过此设备，我希望实现智能化控制，例如每晚11:00自动设为25°C，3:00调整为27°C等。
该设备配有屏幕显示任务状态，支持Wi-Fi连接，可设置和修改任务计划。


## 个人实力
- esp32相关：不懂
- python：略有了解
- micropython：不懂
- 通信相关：不懂
- github交互：不曾

~~综合实力：取决于AI~~


## 探索过程概述
- 无头苍蝇
  - 我将[背景](README.md#背景)部分输入gemini2.5pro，得到指导，上某宝购买了一些零件
  - 我将买到的零件列表（包括参数）输入2.5pro。他给出了硬件连接建议，并建议我使用ArduinoIDE。
  - 学习烧录程序，每次都要按着板子上的boot按钮，很不方便。运行程序要按EN按钮
  - 开启“grounding with google”以后，2.5pro 持续给我输出已经404的红外指令库，让我很苦恼
  - 我要求不再使用Arduino，以避免相关红外库。2.5pro建议使用Thonny 和 micropython。这样只需要在第一次烧录一个解释器，后续在电脑终端控制即可。

- 稍有头绪
  - 由于2.5pro令我不满，我转而使用sonnet3.7。重新配置了硬件连接，并获得了切实可行代码 _（claude确实好用）_
  - 红外接收器接收到遥控器信号，但是发射该信号时空调没反应
  - 意识到可能是程序缺陷，没有学习到完整的红外信号
  - 尝试获得完整的红外信号
  - 转而尝试解码红外信号（需要了解其结构，仅仅学习信号并模拟输出可能无效）
- 有所发现

  - 获得完整，稳定的脉冲信号
  - 尝试理解。把获得的hex码发给gpt-o3，经过指点，得知：
    - 不同的脉冲长度可能代表：帧头，0，1 ······
  - 尝试并实现：
    - 把数值转换为散点图和折线图（方便找到0/1/包头，辨别噪音）
    - 实现通用脚本，把脉冲信号转换成16进制数
    - 把脚本移植到micropython环境，实现端侧解码一条龙
- 深入探索

  - 收集不同的信号并解码，尝试翻译。（方便以后自己制造信号）

······工作中······

## 细节实现与代码
### 配置硬件
#### 首先连接硬件
参见[硬件清单](Hardware%20Check/hardware%20list.md)和[硬件连接](Hardware%20Check/Hardware%20Hookup.py)
#### 检查功能
电脑上用Thonny在esp32上烧录好micropython环境后，运行硬件检测程序。
分别检查[屏幕](Hardware%20Check/screen%20test.py),[红外接收器](Hardware%20Check/IR_Receiver.py)。其中屏幕需要[sh1106驱动](Hardware%20Check/sh1106.py)

红外发射器模块，指示灯可亮，但是实际上空调没反应，不知道哪里出了问题。
### 解码红外信号
#### 获得脉冲信号
接下来尝试获得红外信号。使用[这个](IR%20learn/IR_learn.py)，同一信号对接收器发射三次，程序会给出三次的脉冲信号。
_单次学习可容纳999次脉冲，这是考虑到：有些遥控器（电视机）可以连发同一信号，来提升成功率。我的空调遥控器只会发送一次_

现在我对 27°/26°+开/关 共四种信号分别学习了6次，得到[原始的脉冲信号](IR%20learn/rawdata)。

 _文件夹里的[blank file gen](IR%20learn/rawdata/blank%20file%20gen.py)是我调试时，用于生成一堆文件名带有参数的txt空文件。_

_最内层文件夹里的[decode.py](IR%20learn/rawdata/27pwon/decode.py)是我调试后期做的解码脚本，后面会提到_

## 希望探讨的问题
目前我卡在两个地方
1. 红外码的翻译，详见我收集的信号列表
2. 红外发射器发射信号，空调无反应

以及其他和项目有关的话题

## TODO List

- [x] 硬件搭建
- [x] 屏幕可用
- [x] 红外接收器可用
- [ ] 红外发射器可用
- [x] 接收遥控器信号，得到raw data
- [ ] 模拟并发射遥控器信号，空调响应
- [x] 实现端侧一条龙解码脚本
- [ ] 实现红外指令破译
- [ ] 无电脑辅助，独自学习红外信号
- [ ] 实现局域网控制（sd存储）
······额外······
- [ ] 实现搞笑音效（喇叭）
- [ ] 实现语音指令（麦克风）

## 贡献方式
虚心求教，欢迎各类与项目相关的批评，渴望大神指点

欢迎大家提出建议、反馈或提交 Pull Request。

## 许可证
本项目采用 Apache-2.0协议
